#
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vote for Class Presenter</title>
<style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 40px; }
    h1 { color: green; }
    button { margin: 6px; padding: 10px 20px; cursor: pointer; border-radius: 6px; border: none; }
    .year-btn { background: lightgreen; }
    .candidate-btn { background: darkgreen; color: white; margin: 5px; padding: 10px; border-radius: 5px; }
    .hidden { display: none; }
    table { width: 70%; margin: 20px auto; border-collapse: collapse; }
    table, th, td { border: 1px solid #333; padding: 8px; }
    .class-header { background: lightgreen; }
    input, select { padding: 6px; margin: 5px; }
    .admin-section { border: 2px solid green; padding: 15px; margin: 15px; }
    .remove-btn { margin-left: 8px; background: red; color: white; padding: 3px 6px; border-radius: 4px; cursor: pointer; }
    .reset-btn { background: crimson; color: white; }

    /* Highlight selected candidate */
    .selected-candidate {
        background: gold !important;
        color: black !important;
        font-weight: bold;
    }
</style>
</head>
<body>

<h1>Ethos International School Voting</h1>

<!-- Candidate Data Entry -->
<div class="admin-section">
    <h2>Admin: Add/Remove Candidates</h2>
    <input type="password" id="adminPassword" placeholder="Enter Admin Password" />
    <button onclick="loginAdmin()">Login</button>

    <div id="adminControls" class="hidden">
        <select id="yearSelect">
            <option value="Y4">Year 4</option>
            <option value="Y5">Year 5</option>
            <option value="Y6">Year 6</option>
            <option value="Y7">Year 7</option>
            <option value="Y8">Year 8</option>
            <option value="Y9">Year 9</option>
            <option value="Y10">Year 10</option>
            <option value="Y11">Year 11</option>
        </select>
        <input type="text" id="candidateName" placeholder="Candidate Name" />
        <button onclick="addCandidate()">Add Candidate</button>

        <h3>Current Candidates</h3>
        <div id="candidateList"></div>
    </div>
</div>

<!-- Student Voting -->
<div>
    <h2>Vote for Your Class Presenter</h2>
    <label>Enter Your Year: 
        <select id="studentYear">
            <option value="Y4">Year 4</option>
            <option value="Y5">Year 5</option>
            <option value="Y6">Year 6</option>
            <option value="Y7">Year 7</option>
            <option value="Y8">Year 8</option>
            <option value="Y9">Year 9</option>
            <option value="Y10">Year 10</option>
            <option value="Y11">Year 11</option>
        </select>
    </label>
    <br>
    <button onclick="showCandidates()">Show Candidates</button>
</div>

<div id="candidateButtons" class="hidden">
    <h3>Select Your Candidate</h3>
    <div id="candidates"></div>
</div>

<button id="castVoteBtn" class="hidden" onclick="castVote()">Submit Vote</button>
<p>Total Votes: <span id="totalVotes">0</span></p>

<!-- Results -->
<div>
    <h2>Voting Results</h2>
    <button onclick="requestPassword()">View Results</button>
    <button onclick="hideResults()">Hide Results</button>
    <button class="reset-btn" onclick="resetResults()">Reset Results</button>
    <div id="dataTable" class="hidden"></div>
</div>

<script>
let totalVotes = 0;
let votesData = [];
let candidatesByYear = JSON.parse(localStorage.getItem('candidatesByYear')) || {
    Y4: [], Y5: [], Y6: [], Y7: [], Y8: [], Y9: [], Y10: [], Y11: []
};
let selectedCandidate = '';
let currentYear = '';
const resultsPassword = "Ethos@123";
const adminPassword = "Ethos@123";

// Admin login
function loginAdmin() {
    const entered = document.getElementById('adminPassword').value;
    if (entered === adminPassword) {
        document.getElementById('adminControls').classList.remove('hidden');
        alert("Admin access granted.");
    } else {
        alert("Incorrect admin password!");
    }
}

// Add candidate (admin only)
function addCandidate() {
    const year = document.getElementById('yearSelect').value;
    const name = document.getElementById('candidateName').value.trim();
    if (!name) { alert("Enter a name"); return; }
    candidatesByYear[year].push(name);
    localStorage.setItem('candidatesByYear', JSON.stringify(candidatesByYear));
    document.getElementById('candidateName').value = '';
    renderCandidateList();
    alert(`Candidate ${name} added to ${year}`);
}

// Remove candidate (admin only)
function removeCandidate(year, name) {
    candidatesByYear[year] = candidatesByYear[year].filter(c => c !== name);
    localStorage.setItem('candidatesByYear', JSON.stringify(candidatesByYear));
    renderCandidateList();
    alert(`Candidate ${name} removed from ${year}`);
}

// Render admin candidate list
function renderCandidateList() {
    const container = document.getElementById('candidateList');
    container.innerHTML = '';
    for (const year in candidatesByYear) {
        if (candidatesByYear[year].length) {
            const yearDiv = document.createElement('div');
            yearDiv.innerHTML = `<b>${year}:</b> `;
            candidatesByYear[year].forEach(cand => {
                const span = document.createElement('span');
                span.textContent = cand;
                const rmBtn = document.createElement('button');
                rmBtn.textContent = "❌";
                rmBtn.className = "remove-btn";
                rmBtn.onclick = () => removeCandidate(year, cand);
                yearDiv.appendChild(span);
                yearDiv.appendChild(rmBtn);
                yearDiv.appendChild(document.createTextNode(" "));
            });
            container.appendChild(yearDiv);
        }
    }
}

// Show candidates for student's year
function showCandidates() {
    currentYear = document.getElementById('studentYear').value;
    const list = candidatesByYear[currentYear];
    if (!list.length) { alert("No candidates for this year yet."); return; }
    const container = document.getElementById('candidates');
    container.innerHTML = '';
    list.forEach(cand => {
        const btn = document.createElement('button');
        btn.className = 'candidate-btn';
        btn.textContent = cand;
        btn.onclick = () => selectCandidate(cand, btn);
        container.appendChild(btn);
    });
    document.getElementById('candidateButtons').classList.remove('hidden');
}

// Select candidate
function selectCandidate(name, button) {
    selectedCandidate = name;

    // remove highlight from all buttons
    document.querySelectorAll('.candidate-btn').forEach(btn => {
        btn.classList.remove('selected-candidate');
    });

    // add highlight to selected button
    button.classList.add('selected-candidate');

    document.getElementById('castVoteBtn').classList.remove('hidden');
}

// Cast vote
function castVote() {
    if (!selectedCandidate) { alert("Select a candidate"); return; }
    totalVotes++;
    document.getElementById('totalVotes').textContent = totalVotes;

    const existing = votesData.find(v => v.candidate === selectedCandidate && v.year === currentYear);
    if (existing) {
        existing.count++;
    } else {
        votesData.push({ year: currentYear, candidate: selectedCandidate, count: 1 });
    }

    localStorage.setItem('votesData', JSON.stringify(votesData));
    localStorage.setItem('totalVotes', totalVotes);

    selectedCandidate = '';
    document.getElementById('castVoteBtn').classList.add('hidden');

    // remove highlight after submission
    document.querySelectorAll('.candidate-btn').forEach(btn => {
        btn.classList.remove('selected-candidate');
    });

    alert("Vote submitted!");
}

// Password gate for results
function requestPassword() {
    const entered = prompt("Enter password to view results:");
    if (entered === resultsPassword) {
        document.getElementById('dataTable').classList.remove('hidden');
        displayData();
    } else {
        alert("Incorrect password!");
    }
}

// Hide results
function hideResults() {
    document.getElementById('dataTable').classList.add('hidden');
}

// Display results
function displayData() {
    const container = document.getElementById('dataTable');
    container.innerHTML = '';
    const data = JSON.parse(localStorage.getItem('votesData')) || [];
    const grouped = {};

    data.forEach(v => {
        if (!grouped[v.year]) grouped[v.year] = [];
        grouped[v.year].push(v);
    });

    for (const year in candidatesByYear) {
        const table = document.createElement('table');
        const header = `<tr class="class-header"><th>${year}</th><th>Candidate</th><th>Votes</th></tr>`;
        table.innerHTML = header;
        candidatesByYear[year].forEach(cand => {
            const record = data.find(v => v.candidate === cand && v.year === year);
            const votes = record ? record.count : 0;
            const row = `<tr><td>${year}</td><td>${cand}</td><td>${votes}</td></tr>`;
            table.innerHTML += row;
        });
        container.appendChild(table);
    }
}

// Reset results with password
function resetResults() {
    const entered = prompt("Enter password to reset results:");
    if (entered === resultsPassword) {
        localStorage.removeItem('votesData');
        localStorage.removeItem('totalVotes');
        votesData = [];
        totalVotes = 0;
        document.getElementById('totalVotes').textContent = totalVotes;
        document.getElementById('dataTable').innerHTML = '';
        alert("All voting results have been reset!");
    } else {
        alert("Incorrect password! Reset denied.");
    }
}

// Load saved votes
window.onload = () => {
    votesData = JSON.parse(localStorage.getItem('votesData')) || [];
    totalVotes = parseInt(localStorage.getItem('totalVotes')) || 0;
    document.getElementById('totalVotes').textContent = totalVotes;
    renderCandidateList();
};
</script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>
